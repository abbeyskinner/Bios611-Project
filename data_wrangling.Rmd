---
title: "Data Wrangling"
output: pdf_document
date: "2024-09-17"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(survivoR)
```

```{r}
contestant_data <- read_csv("/home/rstudio/work/data/survivor/contestant_table.csv")
season_data <- read_csv("/home/rstudio/work/data/survivor/season_table.csv")
tribe_data <- read_csv("/home/rstudio/work/data/survivor/tribe_table.csv")
```

I think I'll def use contestant_data and maybe season_data too but not sure about tribe_data

```{r, looking at the data}
## probably should look at proportions for most of these 
ggplot(contestant_data, aes(x=age)) +
  geom_histogram()

ggplot(contestant_data, aes(x=gender)) +
  geom_bar()

ggplot(contestant_data, aes(x=poc)) +
  geom_bar()


contestant_data %>%
  group_by(profession) %>%
  tally()%>% arrange(desc(n))

contestant_data %>%
  group_by(state) %>%
  tally()%>% arrange(desc(n))
```


```{r, winners and looking at graphs}
## winners
contestant_data %>%
  filter(finish==1) %>%
  ggplot(aes(x=age))+
  geom_histogram()

contestant_data %>%
  filter(finish==1) %>%
  ggplot(aes(gender)) +
 geom_bar(aes(fill = as.factor(poc)), position = "dodge")

contestant_data %>%
  filter(finish==1) %>%
  ggplot(aes(poc)) +
  geom_bar()

contestant_data %>%
  filter(finish==1) %>% 
  group_by(profession) %>% tally() %>% arrange(desc(n))

contestant_data %>%
  filter(ftc==1)

```

```{r, first voted out}
## first voted out
contestant_data %>%
  filter(
    finish==16 & num_season %in% c(1,2,3,4,5,6,7,12,15,18) |
    finish==18 & num_season %in% c(8,9,11,17,22,23,24,25,28,29,30,32,35,38,41,42,43) |
    finish==19 & num_season ==14 |
    finish==20
  )  %>%
  ggplot(aes(x=age)) +
  geom_histogram(aes(fill = as.factor(gender)), position = "dodge")

contestant_data %>%
  filter(
    finish==16 & num_season %in% c(1,2,3,4,5,6,7,12,15,18) |
    finish==18 & num_season %in% c(8,9,11,17,22,23,24,25,28,29,30,32,35,38,41,42,43) |
    finish==19 & num_season ==14 |
    finish==20
  )  %>%
  ggplot(aes(gender)) +
 geom_bar(aes(fill = as.factor(poc)), position = "dodge")

contestant_data %>%
  filter(
    finish==16 & num_season %in% c(1,2,3,4,5,6,7,12,15,18) |
    finish==18 & num_season %in% c(8,9,11,17,22,23,24,25,28,29,30,32,35,38,41,42,43) |
    finish==19 & num_season ==14 |
    finish==20
  )  %>%
  ggplot(aes(poc)) +
  geom_bar()
```

```{r, made the merge}
# made the merge
contestant_data %>%
  filter(merge==1) %>%
  ggplot(aes(age)) +
  geom_histogram()

contestant_data %>%
  filter(merge==1) %>%
  ggplot(aes(gender)) +
  geom_bar()

contestant_data %>%
  filter(merge==1)%>%
  group_by(profession) %>% tally() %>% arrange(desc(n))
```

What are some things I could look at?

What types of people win? What types of people make final tribal (+ dont win?) What types of people get voted out first? What types of people don't make the merge v do make the merge? Is there a "lucky" buff color -- i.e. the first color buff that a contest is assigned to - compare this with winners 1st buff colors.


** okay wait... apparently there is an R package called `survivoR` that has data on different things of each season!!!! Im gunna go through them now:

```{r, looking at the difference surivioR datasets}
advantage_details
advantage_data <- advantage_movement
castaways
castaway_details
challenge_description
challenge_results
challenge_summary
confessionals %>% arrange(desc(confessional_count))
episodes %>% arrange(desc(viewers))
screen_time
season_summary
vote_history

confessional_data <- confessionals
```

```{r, win percentage}
challenge_data <- challenge_results %>%
 filter(version =="US",
        season <= 43) 

challenge_wins <- challenge_data %>%
  mutate(
    result = case_when(
    result == "Won" ~ 1,
    result == "Lost" ~ 0,
    result == "Won (immunity only)" ~ 1,
    result == "Won (reward only)" ~ 1,
    result == "Draw" ~ 0 ## treating ties as losses
  )) %>% 
  group_by(castaway_id, season) %>%
  summarise(
    total_challenges_competed = n(),
    total_won = sum(result)
  ) %>%
  mutate(
    win_percentage = total_won/(total_challenges_competed)
  ) %>%
  arrange(season)

contestant_data <- contestant_data %>%
  mutate(
    win_percentage = challenge_wins$win_percentage,
    castaway_id = challenge_data$castaway_id
  )
```


Okay... plan of action -- this is too much data and its overwhelming so I'm gunna stick with what I have except I want to add win percentage. So i can calculate the win percentages and then filter that data so that it matches with the data I have (bc i only have until season 43 i think -- or I can add the contestants that I'm missing bc I do have all their info). Then i can merge it into my contestant dataset so I can see how win percentage plays a part in your overall play. If im feeling up to it i could also go through the advantage data and make a boolean for if a contestant found an advantage (and if they used it -- used it correctly -- and number of advantages found)

```{r, advantages}
advantage_data <- advantage_movement %>%
  filter(version == "US",
        season <= 43)

## found advantage -- add number of advantages and boolean
advantages <- advantage_data %>%
  filter(event %in% c("Found", "Found (beware)", "Received", "Recieved")) %>%
  mutate(num_season=season) %>%
  group_by(castaway_id, num_season) %>%
  summarise(
    num_advantages = n()
  ) %>% arrange(num_season)

contestant_data2 <- contestant_data %>%
  left_join(advantages , by = c("castaway_id", "num_season")) %>%
  mutate(num_advantages = replace_na(num_advantages, 0),
         advantage = case_when( # boolean for advantage
           num_advantages > 0 ~ 1,
           num_advantages == 0 ~ 0
         ))

## played advantaged successfully
advantages_success <- advantage_data %>%
  filter(event == "Played", success == "Yes") %>%
  mutate(num_season=season) %>%
  group_by(castaway_id, num_season) %>%
  summarise(
    num_success=n()
  )

contestant_data3 <- contestant_data2 %>%
  left_join(advantages_success, by = c("castaway_id", "num_season")) %>%
  mutate(num_success = replace_na(num_success, 0),
         advantage_success_rate = num_success/num_advantages, # success rate
         success = case_when( # boolean for successfully playing advantage
           num_success > 0 ~ 1,
           num_success == 0 ~ 0
         ),
         advantage_success_rate = replace_na(advantage_success_rate, 0))
```

```{r, job categories}
## Professions

# Create a function to categorize professions
categorize_profession <- function(profession) {
  # Use a case_when to assign each profession to a category
  category <- dplyr::case_when(
    profession %in% c("Doctor", "Nurse", "Physician", "Nurse Practitioner", "Medical Student", "Phlebotomist",
                      "Pharmacist", "Clinical Psychologist", "Pediatric Nurse", "Anesthesiologist", "Plastic Surgeon",
                      "Urologist", "ER Doctor", "Surgeon", "Nursing Student", "Medical Assistant", 
                       "Dental Student", "Pharmacy Technician", "Neurologist", "Personal Nurse", 
                      "Dentist", "Mortician", "Nursing Practitioner", "Retired Nurse", "EMT/Pro Cheerleader",
                      "Physician/Army Orthopedic Surgery Resident", "Physical Therapist", "Neurosurgeon",
                      "Healthcare Worker", "Therapist", "Heart Valve Specialist", "Biochemist", "Chemical Disposal",
                      "Chemist") 
    ~ "Healthcare & Science",
    
    profession %in% c("Real Estate Developer", "Real Estate Agent", "Real Estate Salesman", "Real State Agent",
                        "Real Estate Broker", "Real Estate Manager", "Property Developer", "Real Estate",
                        "Land Broker", "Residential Builder", "Real Estate Executive", "Realtor", 
                      "Real Estate Agent/Stay-at-home Dad") 
    ~ "Real Estate",
    
    profession %in% c("College Student", "Graduate Student", "PhD Student", "High School Student", "Student/Athlete",
                      "Economics Student", "Student", "Ivy League Student", "Seminary Student", "Business Student",
                      "Political Science PhD", "Ivy League Graduate", "Pre-Med Student", "Model/Student", 
                      "Full-Time Student/Sales", "Crossfit Coach/Physical Therapy Student", "Grad Student") 
    ~ "Student",
    
    profession %in% c("Teacher", "Professor", "Principal", "College Administrator", "Admissions Counselor", 
                      "Academic Intern", "High School Teacher", "Elementary Teacher", "English Teacher", 
                      "P.E. Teacher", "Yoga Instructor/Math Professor", "School Principal", "Gym Teacher", 
                      "English Professor", "Art Teacher", "Student Teacher", "College Admissions Director", 
                        "Education Project Manager", "School Lunch Lady", "4th Grade Teacher", "Bookkeeper",
                      "Physical Education Teacher", "Retired Teacher", "Guidance Counselor", "Physics Teacher",
                      "English Profressor", "Special Education Teacher", "English professor", "Music Teacher") 
    ~ "Education & Academia",
    
    profession %in% c("Sales Manager", "Marketing Director", "Advertising Executive", "Retail Salesperson", 
                       "Internet Projects Manager", "Sales Executive", "Marketing Executive", "Freelance Marketer",
                      "Digital Content Creator", "Account Manager", "Sales & Marketing Associate",
                      "Marketing Manager", "Advertising Salesman", "Sales Representative", "Elevator Salesman",
                        "Communications Manager", "Management Consultant", "Marketing Manager", "Used Car Salesman",
                      "Retail Saleswoman", "Financial Salesman", "Shoe Salesman", "Copier Sales Executive", 
                      "Spa Saleswoman", "Saleswoman", "Insurance Saleswoman", "BMX Bike Salesman", "Software Sales",
                      "Traveling Sales Representative", "Social Media Marketer", "Vacation Club Saleswoman", 
                      "Vacation Club Sales", "Graphic Saleswoman", "Social Media Strategist", "Tech Sales",
                      "Advertising Account Executive", "Publishing CEO", "District Sales Manager", 
                      "Director of Marketing & Communications", "Cyber Security Saleswoman", 
                      "Jewelry Salesman/Photographer", "Social Media Manager", "Pharmaceutical Saleswoman", 
                      "Pharmaceutical Sales Representative", "Pharmaceutical Sales", "Medical Saleswoman", 
                      "Medical Marijuana Dispenser", "Healthcare Consultant", "Medical Sales Representative",
                      "Pharmaceutical Representative", "Media Buyer") 
    ~ "Sales & Marketing",
    
    profession %in% c("Actor", "Actress", "Musician", "Singer", "Artist", "Writer", "Comedian", "Broadcaster", 
                      "Media Consultant", "Photographer", "Television Writer", "Creative Director", 
                      "Musician/Retired Teacher", "Singer/Songwriter", "Aspiring Actress", "Art Consultant",
                      "Freelance Writer", "Vegas Showgirl", "Singer/Entertainer", "Fire Dancer", "Jazz Musician",
                      "Heavy Metal Musician", "Former Model", "Aspiring Writer", "Music Producer", "Wedding Videographer",
                      "Former Pop Star", "Art Student", "Visual Effects Producer", "Spoken Word Artist",
                      "Country Music Singer", "Stand-Up Comedian", "Former TV Teen Star", "Entertainment Host and Writer",
                      "Comic Book Artist", "Singer/Actor/Writer", "Broadway Performer/Model/Aerialist",
                      "Ex-Talent Agent Assistant", "YouTube Sensation", "Entertainment Host/Writer", "Filmmaker", 
                      "Multimedia Artist", "Morning News Anchor", "Talent Manager", "Christian Radio Host", 
                      "Host/Keynote Speaker")
    ~ "Arts, Entertainment & Media",
          
    profession %in% c("Model", "Swimsuit Model", "Pin-Up Model", "Fashion Director", "Footwear Designer",
                        "Cosmetology Student", "Jewelry Designer", "Fashion Stylist", "Massage Therapist",
                        "Makeup Artist", "Hairstylist", "Nail Salon Manager", "Hairdresser","Pageant Coach",
                      "Aspiring Designer", "T-shirt Designer", "Swimsuit Photographer", "Cosmetologist", "Designer",
                      "Former Miss Delaware", "Male Model", "Miss Kentucky Teen USA", "Furniture Designer",
                      "Interior Designer", "Model/Spray Tan Business Owner","Sideline Chic Owner", "Bridal Shop Owner",
                      "Jeweler") 
    ~ "Fashion & Beauty",
    
    profession %in% c("Business Consultant", "Executive Recruiter", "Corporate Trainer", "Product Manager", 
                       "Financial Consultant","Business Development Manager","CEO", "MBA Student", "Financial Assistant",
                      "Investment Banker", "Actuary", "Tax Accountant", "Loan Officer", "Health Club Consultant",
                  "Administrative Assistant", "Behavior Analyst", "Office Manager", "Construction Company Vice President", 
                      "Office Assistant", "Equity Trade Manager", "Document Manager", "Risk Consultant", 
                  "Corporate Consultant", "Office Manager", "Banker", "Administrative Officer", "Accountant", 
                  "Corporate Executive", "Asset Manager", "Insurance Adjuster", "Business Analyst", "Case Manager",
                  "Product Management", "Educational Project Manager", "Project Manager", "Equity Research Assistant",
                  "Business Owner", "Entrepreneur", "Small Business Owner", "Franchise Owner", "Hedge Fund Support") 
    ~ "Finance & Business Management",

    profession %in% c("Lawyer", "District Attorney", "Defense Attorney", "Attorney", "Paralegal", "Judge", 
                    "Trial Attorney", "Civil Rights Attorney", "Legal Secretary", "Public Defender", 
                   "Probation Officer", "Corporate Lawyer", "Law Student", "Law School Student", "Pre-Law Student", 
                   "Law Clerk", "Crime Reporter", "Deputy District Attorney", "Expert Witness Locator", 
                   "Harvard Law Student", "Attorney/Retired NFL Player", "Assistant District Attorney", 
                   "Law Student/Former Military", "Divorce Attorney", "Personal Injury Attorney", 
                   "Attorney/Former NFL Player") 
    ~ "Legal",
    
    profession %in% c("Electrician", "Plumber", "Carpenter", "Mechanic", "Technical Writer", 
                      "Welder", "HVAC Technician", "Construction Worker", "Telephone Technician", "Truck Assembler",
                      "Highway Repair Worker", "Highway Construction Worker", "Steelworker", "Maintenance Man",
                      "Oil Tanker Crewman", "Motorcycle Repairwoman", "Tire Repairman", "General Contractor", 
                      "Oil Driller", "Contractor", "Boat Mechanic", "Construction Supervisor", "Maintenance Manager", 
                      "Factory Worker", "Warehouse Associate", "Auto Customizer", "Lumberjill", 
                      "Water Treatment Technician", "Oil Company Owner", "Pest Control Company Owner") 
    ~ "Skilled Trades & Technical",
    
    profession %in% c("Police Officer", "FBI Agent", "Security Officer", "Retired Navy Seal", "Army Veteran", 
                      "Sheriff", "Corrections Officer", "Navy Seal", "Marine", "SWAT Officer", "Firefighter", 
                      "Detective", "Retired NAVY Seal", "Army Intelligence Officer", "Retired Police Officer",
                      "Ex-Navy Fighter Pilot", "Drill Sergeant", "Retired Fire Captain", "Police Sergeant",
                      "U.S. Army Sergeant", "Iraq War Veteran", "Former Federal Agent?", "Retired NYPD Detective",
                      "Retired LAPD Officer", "Fireman/EMT", "State Trooper", "Former FBI Agent", "S.W.A.T. Officer", 
                      "Air Force Veteran", "Retired Firefighter") 
    ~ "Law Enforcement & Military",
    
    profession %in% c("Personal Trainer", "Fitness Instructor", "CrossFit Coach", "Triathlon Coach", 
                      "Professional Athlete", "NFL/NHL Player", "Gym Owner", "Sports Coach", "Yoga Instructor", 
                       "YMCA Basketball Coach", "Ex-NFL Player", "Former Pro Cyclist", "Olympian", "Paralympian",
                      "Competitive Cyclist", "Professional Soccer Player", "Former Professional Athlete", 
                        "Yoga Instructor", "Basketball Coach", "Navy Swim Instructor", "Health and Fitness Reporter",
                      "Water Skiing Instructor", "Former NFL Quarterback", "Sports Radio Host", "Professional Wrestler",
                      "Profession Volleyball Player", "Boxer", "Cheerleading Coach", "Surfing Instructor",
                      "Gymnastics Coach", "Olympic Gold Medalist", "Professional Cyclist", "Soccer Coach/Musician",
                      "Former Professional Cyclist", "Former NFL Coach", "Swim Coach", "Professional Dancer", 
                      "Dance Team Manager", "Lingerie Football Player", "Baseball/Dating Coach", "Former MLB Player", 
                      "Track Coach", "Former Pro Cyclist/Shop Manager", "Former NBA All-Star", "Ex-NFL Cheerleader",
                      "Pilates Teacher", "Martial Arts Instructor", "Crossfit Coach/Project Coordinator", 
                      "Sailing Instructor", "Former NBA Player", "Bodybuilder", "Dietitian", "Snowboard Instructor",
                      "NFL Player", "Lifeguard", "Mixed Martial Arts Fighter", "Former NHL Player", "Olympic Medalist",
                      "Chief Lifeguard", "CrossFit Trainer", "Fitness Consultant", "Roller Girl", "Surf Instructor",
                      "Competitive Cheerleading Gym Owner", "Miami Marlins President") 
    ~ "Sports & Fitness",
    
   profession %in% c("Social Worker", "Youth Pastor", "Youth Mentor", "Mentor", "Life Coach", "Volunteer",
                     "Mail Carrier", "Career Counselor", "Pastor", "Troubled Teens Mentor", "Motivational Speaker",
                     "Housing Case Manager", "Non-Profit Fundraiser", "Charity Organizer", "Professional Speaker",
                     "Postal Worker", "Homeless Shelter Manager", "YMCA Program Director", "Career Consultant",
                     "Keynote Speaker/Social Entrepreneur", "Life Coach/Speaker/Yoga Teacher", "Missionary Recruiter")
                      
   ~ "Community & Social Services",
    
    profession %in% c("Chef", "Bartender", "Waiter", "Restaurant Owner", "Hotel Doorman", "Caterer", 
                      "Food Service Worker", "Sushi Chef", "Fast Food Franchisee", "Cocktail Waitress",
                      "Cook", "Food Truck Operator", "Restaurant Manager", "Barista", "Waitress", "Coffee Barista", 
                      "Waitress/Bartender", "Personal Chef", "Flight Attendant", "Restaurant Designer", 
                      "Cocktail Waitress/Graphic Designer", "Bellhop", "Kitchen Staff Member", "Bar Manager",
                      "Club Promoter", "Airline Agent", "Customer Service Representative", "Grocery Clerk", 
                      "Ice Cream Entrepreneur", "Ice Cream Scooper", "Merchandiser", "Produce Clerk", "Retail Buyer") 
   ~ "Food, Hospitality, & Retail",
    
    profession %in% c("Farmer", "Rancher", "Fisherman", "Gardener", "Beekeeper", "Wilderness Guide", 
                      "Hunting Guide", "Conservationist", "Park Ranger", "Commercial Fisherman", "Dairy Farmer",
                      "River Rafting Guide", "Teacher/Farmer", "Goat Farmer", "Nature Guide", "Fishing Boat Captain",
                      "Children's Adventure Guide", "Scoutmaster", "Sheep Farmer", "Chicken Farmer", "Hiking Guide",
                      "Cattle Rancher", "Goat Rancher", "Post Office Manager/Farmer", "River Guide", 
                      "Wilderness Therapy Guide", "Fisherwoman", "Fishing Guide", "Fishmonnger", "Dolphin Trainer",
                      "Zookeeper", "Dog Trainer","Horse Trainer", "Marine Animal Trainer", "Veterinarian", "Pet Cremator",
                      "Paddleboard Company Owner", "Beach Service Company Owner", "Barrel Racer", "Bounty Hunter") 
                      
   ~ "Agriculture, Outdoors, & Animal Care",
    
    profession %in% c("Software Developer", "Engineer", "Technology Executive", "IT Manager", "Cybersecurity Analyst", 
                      "App Developer", "Internet Projects Manager", "UX Designer", "Robotics Scientist",
                      "Data Scientist", "Cyber Security Analyst", "Software Publisher", "Rocket Scientist",
                      "Computer Projects Coordinator", "Computer Programmer", "Missile Engineer", "Web Producer",
                      "Internet Technology Director", "Computer Engineer", "Engineer Graduate/Model", "Nuclear Engineer",
                      "Yahoo! Executive", "Quantitative Strategist", "Internet Project Manager", "Industrial Engineer") 
   ~ "Technology & Engineering",

    
    # If it doesnâ€™t fit into any category above, categorize as "Other"
    TRUE ~ "Other"
  )
  
  return(category)
}

contestant_data3 <- contestant_data3 %>%
  mutate(job_category = profession)

# Apply the categorization function to the 'profession' column
contestant_data3$job_category <- sapply(contestant_data3$job_category, categorize_profession)

contestant_data3 %>% filter(job_category=="Other") %>% group_by(profession) %>% summarise(total=n()) %>% arrange(desc(total))
```


```{r, evvie}
# grouping Evvie into the female category because of how they were percieved on the show
contestant_data3 <- contestant_data3 %>%
  mutate(
    gender = case_when(
      gender == "F" ~ "F",
      gender == "N" ~ "F",
      gender == "M" ~ "M"
    ),
    race = case_when(
      poc == 0 ~ "White",
      african_american == 1 ~ "Black",
      asian_american == 1 ~ "Asian",
      latin_american == 1 ~ "Latin American"
    )
  ) 
```

```{r, figure of mean finish by job cat}
x <- contestant_data %>%
  group_by(job_category) %>%
  summarise(
    mean_finish = sum(finish)/n(),
    total = n()
  )%>%
  arrange((mean_finish))

ggplot(x, aes(x = reorder(job_category, mean_finish), y = mean_finish, fill = job_category)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  # Use stat = "identity" for pre-calculated values
  geom_hline(yintercept = mean(contestant_data$finish), color = "red", size = 1) +  # Add  line at overall mean
 # geom_text(aes(label = round(mean_finish, 2)), vjust = -0.3) + # Add labels with rounded mean values
  coord_flip() + 
  labs(
    x = "Job Category",
    y = "Mean Finish",
    title = "Mean Finish by Job Category"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +  # Rotate x-axis labels for readability
  theme_minimal() # Clean theme
```

```{r, figure of mean finihs by age}
contestant_data %>%
  group_by(age) %>%
  summarise(
    mean_finish = sum(finish)/n(),
    total = n()
  )%>%
  arrange(desc(age)) %>%
  ggplot(aes(x = age, y = mean_finish)) +
  geom_bar(stat = "identity")+  # Use stat = "identity" for pre-calculated values
  geom_hline(yintercept = mean(contestant_data$finish), color = "red", size = 1) +  # Add  line at overall mean
 # geom_text(aes(label = round(mean_finish, 2)), vjust = -0.3) + # Add labels with rounded mean values
  labs(
    x = "Age",
    y = "Mean Finish",
    title = "Mean Finish by Age"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +  # Rotate x-axis labels for readability
  theme_minimal() # Clean theme
```

```{r, figure of mean finish by gender}
contestant_data %>%
  group_by(gender) %>%
  summarise(
    mean_finish = sum(finish)/n(),
    total = n()
  ) %>%
  ggplot(aes(x = gender, y = mean_finish, fill=gender)) +
  geom_bar(stat = "identity")+  # Use stat = "identity" for pre-calculated values
  geom_hline(yintercept = mean(contestant_data$finish), color = "red", size = 1) +  # Add  line at overall mean
 # geom_text(aes(label = round(mean_finish, 2)), vjust = -0.3) + # Add labels with rounded mean values
  labs(
    x = "Gender",
    y = "Mean Finish",
    title = "Mean Finish by Gender"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +  # Rotate x-axis labels for readability
  theme_minimal() # Clean theme

contestant_data %>%
  group_by(gender) %>%
  summarise(
    mean_finish = sum(normalized_finish)/n(),
    total = n()
  ) %>%
  ggplot(aes(x = gender, y = mean_finish, fill=gender)) +
  geom_bar(stat = "identity")+  # Use stat = "identity" for pre-calculated values
  geom_hline(yintercept = mean(contestant_data$normalized_finish), color = "red", size = 1) +  # Add  line at overall mean
 # geom_text(aes(label = round(mean_finish, 2)), vjust = -0.3) + # Add labels with rounded mean values
  labs(
    x = "Gender",
    y = "Mean Finish",
    title = "Mean Finish by Gender"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +  # Rotate x-axis labels for readability
  theme_minimal() # Clean theme
```

```{r, figure of mean finish by gender, race}
contestant_data %>%
  group_by(poc) %>%
  summarise(
    mean_finish = sum(normalized_finish)/n(),
    total = n()
  ) %>%
  ggplot(aes(x = as.factor(poc), y = mean_finish)) +
  geom_bar(stat = "identity")+  # Use stat = "identity" for pre-calculated values
  geom_hline(yintercept = mean(contestant_data$normalized_finish), color = "red", size = 1) +  # Add  line at overall mean
 # geom_text(aes(label = round(mean_finish, 2)), vjust = -0.3) + # Add labels with rounded mean values
  labs(
    x = "POC",
    y = "Mean Finish",
    title = "Mean Placement Percentage by POC"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +  # Rotate x-axis labels for readability
  theme_minimal() # Clean theme

contestant_data %>%
  group_by(race, gender) %>%
  summarise(
    mean_finish = sum(normalized_finish/n()),
    total = n()
  ) %>%
  ggplot(aes(x = as.factor(gender), y = mean_finish, fill=as.factor(race))) +
  geom_bar(stat = "identity", position = "dodge")+  # Use stat = "identity" for pre-calculated values
  geom_hline(yintercept = mean(contestant_data$normalized_finish), color = "red", size = 1) +  # Add  line at overall mean
 # geom_text(aes(label = round(mean_finish, 2)), vjust = -0.3) + # Add labels with rounded mean values
  labs(
    x = "Gender",
    y = "Mean Finish",
    title = "Mean Placement Percentage by POC"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +  # Rotate x-axis labels for readability
  theme_minimal() # Clean theme


```

```{r, figure of mean finish by poc/race, gender, lgbt}
contestant_data %>%
  mutate(
    poc = case_when(poc==1 ~ "POC", poc == 0 ~ "White"),
    lgbt = case_when(lgbt == 1 ~ "LGBT", lgbt == 0 ~ "Straight")
  ) %>%
  group_by(gender, race, lgbt) %>%
  summarise(
    mean_finish = sum(finish)/n(),
    total = n()
  ) %>% # Plot with ggplot, faceting by gender, poc, and lgbt
ggplot(aes(x = lgbt, y = mean_finish, fill = race)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(
    x = "Groups (Gender, POC, LGBT)",
    y = "Mean Finish",
    title = "Mean Finish by Gender, POC, and LGBT"
  ) +
  geom_hline(yintercept = mean(contestant_data$finish), color = "red", size = 1) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +  # Rotate x-axis labels for readability
  theme_minimal() +  # Clean theme
  facet_wrap(~gender, scales = "free_x")  # Facet by the three variables

contestant_data %>%
  mutate(
    poc = case_when(poc==1 ~ "POC", poc == 0 ~ "White"),
    lgbt = case_when(lgbt == 1 ~ "LGBT", lgbt == 0 ~ "Straight")
  ) %>%
  group_by(gender, poc, lgbt) %>%
  summarise(
    mean_finish = sum(finish)/n(),
    total = n()
  ) %>% # Plot with ggplot, faceting by gender, poc, and lgbt
ggplot(aes(x = lgbt, y = mean_finish, fill = poc)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(
    x = "Groups (Gender, POC, LGBT)",
    y = "Mean Finish",
    title = "Mean Finish by Gender, POC, and LGBT"
  ) +
  geom_hline(yintercept = mean(contestant_data$finish), color = "red", size = 1) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +  # Rotate x-axis labels for readability
  theme_minimal() +  # Clean theme
  facet_wrap(~gender, scales = "free_x")  # Facet by the three variables

```
> I could try to cluster to see if i can recover these groups

```{r, region}
contestant_data3 <- contestant_data3 %>%
  mutate(
    region = case_when(
      state %in% c("Connecticut", "D.C.", "Delaware", "District of Columbia", 
                  "Maryland", "Massachusetts", "New Jersey", "New York", "Rhode Island",
                  "New Hampshire", "Vermont", "Maine", "Pennsylvania", "Washington DC",
                  "Ontario", "Quebec") ~ "Northeast",
      
    state %in% c("Illinois", "Indiana", "Iowa", "Kansas", "Michigan", "Minnesota", 
                 "Missouri", "Nebraska", "North Dakota", "Ohio", "South Dakota", 
                 "Wisconsin") ~ "Midwest",
    
    state %in% c("Alabama", "Arkansas", "Kentucky", "Louisiana", "Mississippi", 
                 "Oklahoma", "Tennessee", "Texas", "Florida", "Georgia", 
                 "North Carolina", "South Carolina", "Virginia", "West Virginia") ~ "South",
    
    state %in% c("Arizona", "California", "Colorado", "Hawaii", "Idaho", "Montana", 
                 "Nevada", "New Mexico", "Oregon", "Utah", "Washington", "Wyoming") ~ "West"
    )
  )
```

```{r, mean finish by region}
contestant_data3 %>%
  group_by(region) %>%
  summarise(
    mean_finish = sum(finish)/n(),
    total = n()
  ) %>% arrange(mean_finish) %>%
  ggplot(aes(x = region, y = mean_finish, fill=region)) +
  geom_bar(stat = "identity")+  # Use stat = "identity" for pre-calculated values
  geom_hline(yintercept = mean(contestant_data3$finish), color = "red", size = 1) +  # Add  line at overall mean
 # geom_text(aes(label = round(mean_finish, 2)), vjust = -0.3) + # Add labels with rounded mean values
  labs(
    x = "Region",
    y = "Mean Finish",
    title = "Mean Finish by Region"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +  # Rotate x-axis labels for readability
  theme_minimal() # Clean theme

list(table(contestant_data3$state))
```

> this graph looks nice but its misleading bc canada only has 4 people -- idk if its appropriate to drop them or add them to a different section

```{r, figure of mean win percentage by finish}
contestant_data %>%
  group_by(finish) %>%
  summarise(
    mean_win_percentage = sum(win_percentage)/n()
  ) %>%
  ggplot(aes(x = finish, y = mean_win_percentage, fill = finish)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  # Use stat = "identity" for pre-calculated values
  geom_hline(yintercept = mean(contestant_data$win_percentage), color = "red", size = 1) +  # Add  line at overall mean
 # geom_text(aes(label = round(mean_finish, 2)), vjust = -0.3) + # Add labels with rounded mean values
  labs(
    x = "Finish",
    y = "Mean Win Percentage",
    title = "Mean Win Percentage by Finish"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +  # Rotate x-axis labels for readability
  theme_minimal() # Clean theme
```

headshots -- using their faces to predict how long they last in the season -- can attractiveness predict how long you stay in the game
## PCA, Clustering 

```{r}
pca_data <- contestant_data %>%
  select(age, gender, poc, lgbt, num_appearance, win_percentage, num_advantages, 
         advantage_success_rate, confessionals_per_episode) %>%
  mutate(gender = case_when(
    gender == "M" ~ 0,
    gender == "F" ~ 1
  )) %>%
  mutate(across(where(is.factor), ~ as.numeric(as.character(.)))) %>% as.matrix()

pca_result <- prcomp(pca_data, scale. = TRUE)
pcs <- pca_result$x %>% 
  as_tibble() %>% 
  select(PC1, PC2, PC3, PC4, PC5, PC6) %>%
  mutate(
    finish = contestant_data$finish
  )

data_with_pcs <- contestant_data %>%
  mutate(
    PC1 = pcs$PC1,
    PC2 = pcs$PC2,
    PC3 = pcs$PC3
  )

ggplot(data_with_pcs, aes(PC1, PC2)) + geom_point(aes(color=(poc)))

## poc pc2, gender (pc1, and pc2? ), advantage, success pc1,
# age, num_appearance pc2

```

```{r}
kmeans_results <- kmeans(pca_data, 3)

data_with_pcs <- data_with_pcs %>%
  mutate(
    cluster = kmeans_results$cluster
  )

ggplot(data_with_pcs, aes(PC1, PC2)) + geom_point(aes(color=factor(cluster)))

```

Next -- I should run a logistic regression or a random forest to see how well the model can predict how far a contestant will make it. make sure to split into train and test


```{r}
model1 <- lm(data = contestant_data, finish ~ age + gender + poc + lgbt +
               num_appearance + win_percentange + advantage + success + job_category)

model1 <- lm(data = contestant_data, normalized_finish ~ age + gender + poc + lgbt +
               num_appearance + win_percentage + advantage + success + job_category +
               confessionals_per_episode + mb_ei + mb_sn + mb_tf + mb_jp)
summary(model1)
plot(model1)

set.seed(220)
train_data <- contestant_data %>% sample_frac(0.7)
test_data <- setdiff(contestant_data, train_data)

model <- lm(data = train_data, normalized_finish ~ age + gender + poc + lgbt +
               num_appearance + win_percentage + advantage + success + job_category +
               confessionals_per_episode + mb_ei + mb_sn + mb_tf + mb_jp)
summary(model)
plot(model)

pred_vals <- predict(model, test_data) %>% as.tibble()

predictions <- test_data %>%
  mutate(
    pred_vals = pred_vals
  )

model$fitted.values

```

```{r}
# Filter and clean data for regression
regression_data <- contestant_data %>%
  select(normalized_finish, age, gender, race, region, job_category, 
         win_percentage, num_advantages, advantage_success_rate, num_appearance,
         confessionals_per_episode, mb_ei, mb_sn, mb_tf, mb_jp)


# Convert categorical variables to factors
regression_data <- regression_data %>%
  mutate(
    gender = as.factor(gender),
    race = as.factor(race),
    region = as.factor(region),
    job_category = as.factor(job_category),
    mb_ei = as.factor(mb_ei),
    mb_sn = as.factor(mb_sn),
    mb_tf = as.factor(mb_tf),
    mb_jp = as.factor(mb_jp)
  )

finish_model <- lm(normalized_finish ~ age + gender + race + region + job_category + 
                      win_percentage + num_advantages + advantage_success_rate + num_appearance +
                   confessionals_per_episode + mb_ei + mb_sn + mb_tf + mb_jp, 
                      data = regression_data)

# Summarize the model
summary(finish_model)

plot(finish_model)


```

```{r}
library(forcats)
ggplot(contestant_data, aes(x = fct_reorder(job_category, normalized_finish, .fun = median), 
                            y = normalized_finish, fill = job_category)) +
    geom_boxplot(outlier.color = "red", alpha = 0.8) +
    coord_flip() +
    labs(title = "Survivor Placement Percentile by Job Category",
         x = "Job Category",
         y = "Placement Percentile") +
    theme_minimal() +
    geom_hline(yintercept = mean(contestant_data$normalized_finish), 
               color = "red", size = 1) +  # Add  line at overall mean
    theme(legend.position = "none") # Hide legend for cleaner visualization


contestant_data %>%
  mutate(
    gender_race = paste(gender, race, sep = " + ")  # Create a combined variable
  ) %>%
  # group_by(gender_race) %>%
  # summarise(
  #   mean_finish = mean(normalized_finish, na.rm = TRUE),
  #   total = n()
  # ) %>%
  ggplot(aes(x = reorder(gender_race, normalized_finish), y = normalized_finish, fill = gender)) +
  geom_boxplot(alpha = 0.8) +  # Use bar plot with calculated means
  geom_hline(yintercept = mean(contestant_data$normalized_finish, na.rm = TRUE), 
             color = "red", size = 1) +  # Add overall mean line
  labs(
    title = "Mean Finish by Gender and Race",
    x = "Gender + Race",
    y = "Mean Finish"
  ) +
  theme_minimal() +
  coord_flip() +  # Flip the axes for better readability
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels
    legend.position = "none"  # Remove legend for clarity
  )
```

Also it would probs be good to start separating this file into different R scripts for the Makefile

```{r}
contestant_data %>%
  group_by(job_category) %>%
  summarise(mean_win_percentage = mean(win_percentage, na.rm = TRUE)) %>%
  ggplot(aes(x = reorder(job_category, mean_win_percentage), y = mean_win_percentage)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  coord_flip() +
  geom_hline(yintercept = mean(contestant_data$win_percentage), color = "red", size = 1) +  # Add  line at overall mean
  labs(title = "Average Win Percentage by Job Category", x = "Job Category", y = "Win Percentage")
```

```{r}
contestant_data %>% filter(advantage == 1) %>%
  group_by(job_category) %>%
  summarise(
    n = n(),
    avg_success_rate = mean(advantage_success_rate, na.rm = TRUE)
  ) %>%
 ggplot(aes(x = reorder(job_category, avg_success_rate), y = avg_success_rate)) +
  geom_bar(stat = "identity", position = "dodge", fill = "skyblue") +
  coord_flip() +
  geom_hline(yintercept = mean((contestant_data %>% filter(advantage == 1))$advantage_success_rate), 
             color = "red", size = 1) +  # Add  line at overall mean
  labs(title = "Advantage Success Rate by Job Category", x = "Gender", y = "Average Value")


contestant_data %>%
  ggplot(aes(x = region, y = normalized_finish, fill = region)) +
  geom_boxplot() +
  coord_flip() +
  labs(title = "Placement Distribution by Region", x = "Region", y = "Placement Percentile") +
  theme_minimal()

```

```{r}
## this graph is good -- not sure if i will use anything else 
contestant_data %>%
  group_by(num_season) %>%
  summarise(
    pct_poc = mean(race != "White", na.rm = TRUE) * 100,
    pct_queer = mean(lgbt == 1, na.rm = TRUE) * 100
  ) %>%
  pivot_longer(cols = c(pct_poc, pct_queer), names_to = "Group", values_to = "Percentage") %>%
  ggplot(aes(x = num_season, y = Percentage, color = Group)) +
  geom_line(size = 1) +
  labs(title = "Diversity Representation Over Seasons", x = "Season", y = "Percentage", color = "Group")

contestant_data %>%
  group_by(num_season) %>%
  filter(ftc == 1) %>%
  summarise(
    pct_poc = mean(race != "White", na.rm = TRUE) * 100,
    pct_queer = mean(lgbt == 1, na.rm = TRUE) * 100
  ) %>%
  pivot_longer(cols = c(pct_poc, pct_queer), names_to = "Group", values_to = "Percentage") %>%
  ggplot(aes(x = num_season, y = Percentage, color = Group)) +
  geom_line(size = 1) +
  labs(title = "Diversity Representation of FTC Over Seasons", x = "Season", y = "Percentage", color = "Group")


mean((contestant_data %>%
  group_by(num_season) %>%
  summarise(
    pct_poc = mean(race != "White", na.rm = TRUE)
  ))$pct_poc)

library(knitr)

contestant_data %>%
  filter(
    finish==16 & num_season %in% c(1,2,3,4,5,6,7,12,15,18) |
    finish==18 & num_season %in% c(8,9,11,17,22,23,24,25,28,29,30,32,35,38,41,42,43) |
    finish==19 & num_season ==14 |
    finish==20
  ) %>%
  group_by(gender, poc) %>%
  summarise(
    actual = n()
  ) %>%
  mutate(
    expected = case_when(
      poc == 0 ~ 42*(0.5)*(1-.2905175),
      poc ==1 ~ 42*(0.50)*(.2905175)
      )
  ) %>%
  pivot_longer(cols = c(actual, expected), names_to = "type", values_to = "value") %>%
  pivot_wider(names_from = type, values_from = value) %>%
  kable(caption = "Actual vs Expected Counts by Gender and POC Status")
  
  
  
  summarise(
    poc_count = sum(poc == 1, na.rm = TRUE),          # Count of 1s in 'poc'
    lgbt_count = sum(lgbt == 1, na.rm = TRUE),        # Count of 1s in 'lgbt'
    male_count = sum(gender == "M", na.rm = TRUE),    # Count of 'M's in 'gender'
    female_count = sum(gender == "F", na.rm = TRUE) 
  )

```

```{r}
contestant_data %>%
  group_by(num_season) %>%
  summarise(
    pct_poc = mean(race != "White", na.rm = TRUE) * 100,
    pct_queer = mean(lgbt == 1, na.rm = TRUE) * 100
  ) %>%
  pivot_longer(cols = c(pct_poc, pct_queer), names_to = "Group", values_to = "Percentage") %>%
  ggplot(aes(x = num_season, y = Percentage, color = Group)) +
  geom_line(size = 1) +
  labs(title = "Diversity Representation Over Seasons", x = "Season", y = "Percentage", color = "Group")
```


```{r}
confessionals %>% 
  filter(version == "US") %>%
  group_by(season, castaway_id) %>%
  summarise(
    num_confessionals = sum(confessional_count),
    num_episodes = n(),
    confessionals_per_episode = num_confessionals/num_episodes
  )
```

```{r}
contestant_data

seasons44_46 <- castaways %>% 
  filter(version == "US", castaway_id > "US0644") %>%
  mutate(
    num_appearance = case_when(
      castaway_id == "US0657" & season == 45 ~ 2,
      TRUE ~ 1
    ),
    jury = as.numeric(jury),
    finalist = as.numeric(finalist),
    normalized_finish = (18-result_number)/18
  ) %>%
  rename(contestant_name = full_name,
         num_season = season,
         finish = result_number,
         ftc = finalist,
         num_boot = order,
         tribe1 = original_tribe)

seasons44_46_info <- castaway_details %>% 
  filter(substr(castaway_id, 1, 2) == "US") %>% 
  rename(
    profession = occupation, 
    contestant_name = full_name,
    african_american = african,
    asian_american = asian,
    poc = bipoc,
    birthdate=date_of_birth
  ) %>%
  mutate(
    gender = case_when(
      gender == "Female" ~ "F",
      gender == "Male" ~ "M",
      TRUE ~ "F"
    ),
    african_american = as.numeric(african_american),
    asian_american = as.numeric(asian_american),
    latin_american = as.numeric(latin_american),
    poc = as.numeric(poc),
    lgbt = as.numeric(lgbt)
  )



contestant_data_44_46 <- seasons44_46 %>%
  inner_join(seasons44_46_info, by = "castaway_id") %>% 
  select(castaway_id, num_season, contestant_name.x, age, state, num_boot,
         tribe1, jury, ftc, finish, num_appearance, normalized_finish, birthdate,
         gender, african_american, asian_american, latin_american, poc, lgbt,
         profession) %>%
  rename(contestant_name = contestant_name.x)

contestants_all_seasons <- bind_rows(contestant_data, contestant_data_44_46) 

contestants_all_seasons %>%
  left_join(seasons44_46_info %>% select(castaway_id, personality_type), by="castaway_id")

```

```{r}
castaways %>%
  filter(version == "US") %>%
  group_by(castaway_id, season) %>%
  summarise(
    n = n()
  )
length((castaways%>% filter(version=="US"))$castaway_id)

(castaway_details %>%
  filter(substr(castaway_id, 1, 2) == "US"))$personality_type

contestant_data %>%
  left_join(
    castaway_details %>%
      filter(substr(castaway_id, 1, 2) == "US") %>%
      select(castaway_id, personality_type),
    by = "castaway_id"
  )

```

```{r}
contestant_data %>%
  mutate(
    mb_ei = case_when(
      substr(personality_type, 1, 1) == "E" ~ "Extraversion",
      substr(personality_type, 1, 1) == "I" ~ "Introversion",
      TRUE ~ NA
    ),
    mb_sn = case_when(
      substr(personality_type, 2, 2) == "S" ~ "Sensing",
      substr(personality_type, 2, 2) == "N" ~ "Intuition",
      TRUE ~ NA
    ),
    mb_tf = case_when(
      substr(personality_type, 3, 3) == "T" ~ "Thinking",
      substr(personality_type, 3, 3) == "F" ~ "Feeling",
      TRUE ~ NA
    ),
    mb_jp = case_when(
      substr(personality_type, 4, 4) == "J" ~ "Judging",
      substr(personality_type, 4, 4) == "P" ~ "Perceiving",
      TRUE ~ NA
    )
  )
```

